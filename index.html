<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>IPTV Player com Video.js</title>
  <link href="https://vjs.zencdn.net/8.3.0/video-js.css" rel="stylesheet" />
  <style>
    /* Estilos gerais */
    body {
      margin: 0;
      background-color: #111;
      font-family: sans-serif;
      color: #fff;
      display: flex;
      height: 100vh;
    }

    #sidebar {
      width: 250px;
      background-color: #222;
      height: 100%;
      overflow-y: auto;
      padding: 10px;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    #sidebar.hidden {
      width: 0;
      padding: 0;
    }

    #categoryButtons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .category-btn {
      background-color: #333;
      color: #fff;
      padding: 5px 10px;
      font-size: 14px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .category-btn:hover {
      background-color: #444;
    }

    .category {
      margin-top: 20px;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      padding: 10px;
      cursor: pointer;
      background-color: #333;
      border-radius: 5px;
      text-align: center;
      transition: background-color 0.3s;
    }

    .category:hover {
      background-color: #444;
    }

    .channel {
      display: flex;
      align-items: center;
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #333;
      font-size: 14px;
      transition: 0.3s;
    }

    .channel:hover {
      background-color: #444;
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 5px;
      margin-right: 10px;
      object-fit: cover;
    }

    .logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .epg {
      font-size: 12px;
      color: #aaa;
      margin-top: 5px;
    }

    #player-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .video-js {
      width: 95%;
      height: 95%;
      border-radius: 10px;
    }

    #status {
      font-size: 14px;
      margin-top: 5px;
      color: #ccc;
      text-align: center;
    }

    #menu-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      background-color: #0066cc;
      padding: 10px;
      border-radius: 50%;
      color: white;
      cursor: pointer;
    }

    #epg-container {
      padding: 10px;
      background-color: #222;
      color: #fff;
      font-size: 14px;
      border-radius: 5px;
      margin-top: 10px;
      max-height: 100px;
      overflow-y: auto;
    }

    #epg-title {
      font-size: 16px;
      margin-bottom: 5px;
    }

    #epg-content {
      font-size: 14px;
      color: #aaa;
    }
  </style>
</head>
<body>

  <div id="menu-toggle">☰</div>

  <div id="sidebar">
    <h2>IPTV DO EVERSON</h2>
    <div id="categoryButtons"></div>
    <div id="channelList">Nenhuma lista carregada ainda.</div>
  </div>

  <div id="player-container">
    <video
      id="iptv-player"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
      autoplay
    ></video>
    <div id="status">Selecione um canal para assistir</div>

    <div id="epg-container">
      <div id="epg-title">EPG:</div>
      <div id="epg-content">Não há EPG disponível</div>
    </div>
  </div>

  <script src="https://vjs.zencdn.net/8.3.0/video.min.js"></script>
  <script>
    const channelList = document.getElementById("channelList");
    const status = document.getElementById("status");
    const player = videojs("iptv-player");
    const epgContainer = document.getElementById("epg-container");
    const menuToggle = document.getElementById("menu-toggle");
    const sidebar = document.getElementById("sidebar");
    const categoryButtons = document.getElementById("categoryButtons");

    let currentEPG = "";

    menuToggle.onclick = () => {
      sidebar.classList.toggle('hidden');
    };

    function parseM3U(m3u) {
      const lines = m3u.split('\n');
      const channels = {};
      let currentCategory = 'Outros';

      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('#EXTINF')) {
          const nameMatch = lines[i].match(/,(.*)/);
          const name = nameMatch ? nameMatch[1].trim() : "Canal";
          const url = lines[i + 1];
          const categoryMatch = lines[i].match(/group-title="([^"]+)"/);
          const category = categoryMatch ? categoryMatch[1].trim() : 'Outros';
          const logoMatch = lines[i].match(/tvg-logo="([^"]+)"/); 
          const logo = logoMatch ? logoMatch[1].trim() : null;
          const epgMatch = lines[i].match(/tvg-name="([^"]+)"/);
          const epg = epgMatch ? epgMatch[1].trim() : null;

          if (url && url.startsWith("http")) {
            if (!channels[category]) {
              channels[category] = [];
            }
            channels[category].push({ name, url, logo, epg });
          }
        }
      }
      return channels;
    }

    async function loadChannels(url) {
      const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
      try {
        const res = await fetch(proxyUrl);
        const data = await res.json();
        const text = data.contents;
        console.log("Conteúdo da lista:", text);
        const channels = parseM3U(text);

        channelList.innerHTML = "";
        categoryButtons.innerHTML = "";  // Limpa os botões de categorias

        if (Object.keys(channels).length === 0) {
          channelList.innerHTML = "<p>Nenhum canal encontrado.</p>";
          return;
        }

        // Criando os botões para cada categoria
        for (const category in channels) {
          const button = document.createElement("button");
          button.className = "category-btn";
          button.textContent = category;

          button.onclick = () => {
            displayChannels(channels[category]);
          };

          categoryButtons.appendChild(button);
        }

        // Exibindo os canais da primeira categoria por padrão
        if (Object.keys(channels).length > 0) {
          const firstCategory = Object.keys(channels)[0];
          displayChannels(channels[firstCategory]);
        }
      } catch (err) {
        channelList.innerHTML = `<p style="color: red;">Erro ao carregar a lista.</p>`;
        console.error("Erro ao carregar a lista:", err);
      }
    }

    function displayChannels(channels) {
      channelList.innerHTML = "";

      channels.forEach((canal) => {
        const div = document.createElement("div");
        div.className = "channel";
        
        const logoDiv = document.createElement("div");
        logoDiv.className = "logo-container";
        if (canal.logo) {
          const img = document.createElement("img");
          img.className = "logo";
          img.src = canal.logo;
          logoDiv.appendChild(img);
        }
        
        const channelName = document.createElement("span");
        channelName.textContent = canal.name;
        logoDiv.appendChild(channelName);

        div.appendChild(logoDiv);

        div.onclick = () => {
          // Teste para garantir que o tipo de mídia é suportado
          player.src({
            src: canal.url,
            type: 'application/x-mpegURL'
          });

          player.play();
          status.textContent = `Assistindo: ${canal.name}`;
          currentEPG = canal.epg || "Sem EPG disponível";
          epgContainer.querySelector("#epg-content").textContent = `EPG: ${currentEPG}`;
        };
        channelList.appendChild(div);
      });
    }

    window.onload = () => {
      const pastebinUrl = 'https://pastebin.com/raw/8diyLkud';
      loadChannels(pastebinUrl);
    };
  </script>
</body>
</html>
